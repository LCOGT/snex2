{% load tom_common_extras targets_extras custom_code_tags %}
<dl class="row">
  <h4>Known as: </h4>
</dl>
<dl class="row">
  <ul style="list-style-type: none; margin-left: -30px; margin-bottom: -10px;">
  {% for target_name in target|smart_name_list %}
    {% if 'AT ' in target_name or 'SN ' in target_name %}
    <li><a href="https://www.wis-tns.org/object/{{ target_name|slice:"3:" }}" style="color: black;" target="_blank">{{ target_name }}</a><br></li>
    {% elif 'ZTF' in target_name %}
    <li><a href="https://alerce.online/object/{{ target_name }}" style="color: black;" target="_blank">{{ target_name }}</a><br></li>
    {% else %}
    <li><a>{{ target_name }}</a><br></li>
    {% endif %}
  {% endfor %}
  </ul>
</dl>
<dl class="row" style="margin-left: -15px;">
  <form style="display: inline"; name="form_addname" action="javascript: add_name()">
    <input type="hidden" name="targetid" id="targetid" value={{ target.id }}>
    <input type="show" name="newname" id="thenewname" placeholder="Add a new name" style="background: none; border: 0px solid #174460; font-family: 'Open Sans', sans-serif; color: black;">
  </form>
  <script>
  function add_name() {
    var targetid = {{ target.id }};
    var newname = $('#thenewname').val();
    $.ajax({
      url: '/api/targets/' + targetid + '/',
      type: "PATCH",
      headers: {"X-CSRFToken": '{{ csrf_token }}'},
      data: JSON.stringify({
	"aliases": [
	  {"name": newname}
	]
      }),
      contentType: "application/JSON",
      dataType: "json",
      success: function() {
	$.ajax({
	  url: '{% url "sync_targetextra" %}',
	  data: {"newdata": JSON.stringify({
		  "targetid": targetid,
		  "key": "name",
		  "value": newname})
	  },
	  dataType: "json"
	})
      },
      error: function(e) {
        console.log(e);
      }
    })
  }
  </script>
</dl> 
{% science_tags_dropdown target %}
<dl class="row">
  <h5>Interested Persons:</h5>
</dl>
{% interested_persons target user "targetdetail" %}
<dl class="row" style="display: block;">
  <h5>Data Used In: </h5>
  {% papers_list target %}
  {% papers_form target %}
</dl>
<dl class="row" style="display: block;">
  <h5>Data Sharing</h5>
  <!--div class="dropdown-check-list">
    <button class="dropbtn" style="background-color: white; color: black; font-size: 16px; border-color: #174460;" onclick="displayTopics('all')">Share all data to...</button>
      <div id="all-topic-dropdown" class="dropdown-content" style="background-color: white; color: black; font-size: 14px; border: none;">
        <span><input type="checkbox" class="all-check" id="all-select-topic1" value="topic1">Topic1</span><br>
        <span><input type="checkbox" class="all-check" id="all-select-topic2" value="topic2">Topic2</span><br>
	<button onclick="submitToHermes('allbtn', 'all')" id='allbtn' class="btn" style="background-color: #174460; color: white; border: none;">Share</button>
      </div>
  </div>
  <div class="dropdown-check-list">
    <button class="dropbtn" style="background-color: white; color: black; font-size: 16px; border-color: #174460;" onclick="displayTopics('phot')">Share all photometry to...</button>
      <div id="phot-topic-dropdown" class="dropdown-content" style="background-color: white; color: black; font-size: 14px; border: none;">
        <span><input type="checkbox" class="phot-check" id="phot-select-topic1" value="topic1">Topic1</span><br>
        <span><input type="checkbox" class="phot-check" id="phot-select-topic2" value="topic2">Topic2</span><br>
	<button onclick="submitToHermes('photbtn', 'phot')" id="photbtn" class="btn" style="background-color: #174460; color: white; border: none;">Share</button>
      </div>
  </div>
  <div class="dropdown-check-list">
    <button class="dropbtn" style="background-color: white; color: black; font-size: 16px; border-color: #174460;" onclick="displayTopics('spec')">Share all spectra to...</button>
      <div id="spec-topic-dropdown" class="dropdown-content" style="background-color: white; color: black; font-size: 14px; border: none;">
        <span><input type="checkbox" class="spec-check" id="spec-select-topic1" value="topic1">Topic1</span><br>
        <span><input type="checkbox" class="spec-check" id="spec-select-topic2" value="topic2">Topic2</span><br>
	<button onclick="submitToHermes('specbtn', 'spec')" id='specbtn' class="btn" style="background-color: #174460; color: white; border: none;">Share</button>
      </div>
  </div-->
</dl>
<dl class="row">
  <h5>Reference Status:</h5>
</dl>
{% reference_status target %}
<dl class="row">
  <h5>Known to:</h5>
</dl>
{% display_group_list target %}
<script>
function submitToHermes(btnId, data_type) {
  var targetid = {{ target.id }};
  var checkboxes = document.getElementsByClassName(data_type+"-check");
  var topics = [];
  for (var i=0; i<checkboxes.length; i++) {
    if (checkboxes[i].checked) {
      topics.push(checkboxes[i].value);
    }
  };
  //$.ajax({
  //  url: '', #TODO: Replace with Hermes view url
  //  headers: {"X-CSRFToken": '{{ csrf_token }}'},
  //  data: {'target_id': targetid,
  //         'topic': JSON.stringify(topics),
  //         'data_type': data_type,
  //  },
  //  contentType: "application/JSON",
  //  dataType: "json",
  //  success: function(response) {
  //    document.getElementById(btnId).innerHTML = response.success;
  // }
  //})
}
function displayTopics(type) {
  document.getElementById(type+'-topic-dropdown').classList.toggle("show");
}
</script>
